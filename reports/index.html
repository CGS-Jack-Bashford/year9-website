<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Report Generator</title>
		<style>
			select, form, h1, div {
				margin-bottom: 10px;
				display: block;
				width: 800px;
				margin-left: auto;
				margin-right: auto;
			}

			h1 {
				margin-top: 0;
				text-align: center;	
			}

		</style>
		<script>
			// https://stackoverflow.com/questions/14446447/how-to-read-a-local-text-file
			function readTextFile(file)
			{
				var allText = "";
				var rawFile = new XMLHttpRequest();
				rawFile.open("GET", file, false);
				rawFile.onreadystatechange = function ()
				{
					if(rawFile.readyState === 4)
					{
						if(rawFile.status === 200 || rawFile.status == 0)
						{
							allText = rawFile.responseText;
						}
					}
				}
				rawFile.send(null);
				return allText;
			}

			function populateOptions(textFile, selId) {
				var optList = readTextFile(textFile);
				optList = optList.split("\n");
				var optDisplay = document.getElementById(selId);
				for (i=0;i<optList.length;i++) {
					var option = document.createElement("OPTION");
					option.text = optList[i];
					if (option.text.startsWith("+")) {
						option.style.color = "blue";
					} else {
						option.style.color = "red";
					}
					optDisplay.add(option);
				}
				optDisplay.size = optList.length + 1;
			}

			function addText(text) {
				if (plus.includes(text) || minus.includes(text)) {
					return;
				}
				text = updateTextWithGender(text);
				if (text.startsWith("+")) {
					plus.push(text);
				} else {
					minus.push(text);
				}
				refreshComments();
			}

			function removeText(text) {
				var index = plus.indexOf(text);
				if (index != -1) {
					plus.splice(index, 1);
				}
				index = minus.indexOf(text);
				if (index != -1) {
					minus.splice(index, 1);
				}
				refreshComments();
			}

			function updateGender(value) {
				isMale = value;
				for (i=0;i<plus.length;i++) {
					plus[i] = updateTextWithGender(plus[i]);
				}
				for (i=0;i<minus.length;i++) {
					minus[i] = updateTextWithGender(minus[i]);
				}
				refreshComments();
			}

			function updateTextWithGender(text) {
				if (isMale) {
					text = text.replace("his/her","his");
					text = text.replace("he/she", "he");
					text = text.replace(" her ", " his ");
					text = text.replace(" she ", " he ");
				} else {
					text = text.replace("his/her","her");
					text = text.replace("he/she", "she");
					text = text.replace(" his ", " her ");
					text = text.replace(" he ", " she ");
				}
				return text;
			}

			function refreshComments() {
				var optDisplay = document.getElementById("selComments");
				optDisplay.innerHTML = "";
				var optGroup = document.createElement("OPTGROUP");
				optGroup.label = "Comments"
				optDisplay.add(optGroup);
				var textArea = document.getElementById("textArea");
				textArea.value = "";
				for (i=0;i<plus.length;i++) {
					var option = document.createElement("OPTION");
					option.text = plus[i];
					option.style.color = "blue";
					optDisplay.add(option);
					textArea.value+=plus[i]+"\n";
				}
				for (i=0;i<minus.length;i++) {
					var option = document.createElement("OPTION");
					option.text = minus[i];
					option.style.color = "red";
					optDisplay.add(option);
					textArea.value+=minus[i]+"\n";
				}
				copy();
			}

			function copy() {
				var textArea = document.getElementById("textArea");
				textArea.setAttribute("style","display: block");
				textArea.select();
				document.execCommand("copy");
				//alert("Copied: <br/>" + textArea.value)
				textArea.setAttribute("style","display: none");
			}

			function clearComments() {
				plus.length = 0;
				minus.length = 0;
				refreshComments();
			}

		</script>
	</head>
	<body>
		<h1>
			Report Generator
		</h1>
		<select id="selClass" onDblClick="addText(this.value)" size="10"><optgroup label="Class"/></select>
		<select id="selGeneral" onDblClick="addText(this.value)" size="10"><optgroup label="General"/></select>
		<select id="selCoding" onDblClick="addText(this.value)" size="10"><optgroup label="Coding"/></select>
		<select id="selAssignments" onDblClick="addText(this.value)" size="10"><optgroup label="Assignments"/></select>
		<select id="selComments" onDblClick="removeText(this.value)" size="7"><optgroup label="Comments"/></select>
		<div>
			
		
			<input type="radio" onclick=updateGender(true) name="gender" value="male" checked=true> Male
			<input type="radio" onclick=updateGender(false) name="gender" value="female"> Female
			<button onclick="copy()">
				Copy to Clipboard
			</button>

			<button onclick="clearComments()">
				Clear comments
			</button>
		</div>



		<textarea id="textArea" rows=6 cols=130 style="display: none"></textarea>
		<script>
			populateOptions("class.text", "selClass");
			populateOptions("general.text", "selGeneral");
			populateOptions("coding.text", "selCoding");
			populateOptions("assignments.text", "selAssignments");
			var plus = [];
			var minus = [];
			var isMale = true;
		</script>
	</body>
</html>
